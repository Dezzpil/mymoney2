#!/usr/bin/env node

const util = require('util');
const Telegraf = require('telegraf')

const token = process.env.TELEGRAM_TOKEN;
const name = process.env.TELEGRAM_NAME;
const bot = new Telegraf(token, {username: name});

// Http webhook, for nginx/heroku users.
// https://telegraf.js.org/#/?id=webhooks
// TODO Express.js example integration !
const port = process.env.PORT;
bot.startWebhook(`/bot${token}`, null, port);

bot.hears(/^(\d+.+)/i, (ctx) => {
    const message = ctx.message;
    try {
        saver.setInput(message).save(connector, (result) => {
            let debug = util.inspect(result, {showHidden: false, depth: null});
            ctx.reply(debug);
        });
    } catch (e) {
        let debug = util.inspect(e, {showHidden: false, depth: null});
        ctx.reply(debug);
    }
});